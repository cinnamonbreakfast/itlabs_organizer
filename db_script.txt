
DROP TABLE IF EXISTS Users CASCADE;
DROP TABLE IF EXISTS TimeTable CASCADE;
DROP TABLE IF EXISTS Specialist CASCADE;
DROP TABLE IF EXISTS Company CASCADE;
DROP TABLE IF EXISTS SpecialistService CASCADE;
DROP TABLE IF EXISTS Availability CASCADE;
DROP TABLE IF EXISTS Service CASCADE;
DROP TABLE IF EXISTS Schedule CASCADE;

CREATE TABLE Users( -- user is taken by postgres
	id INT GENERATED ALWAYS AS IDENTITY,
	name VARCHAR(255),
	email VARCHAR(255) UNIQUE,
	password VARCHAR(255),
	phone VARCHAR(255) UNIQUE,
	image_url VARCHAR(255),
	role INT,
	verified_email INT  DEFAULT 0,
	verified_phone INT DEFAULT 0,
	city VARCHAR(255),
	country VARCHAR(255),
	PRIMARY KEY(id)
);

CREATE TABLE Company(
	id INT GENERATED ALWAYS AS IDENTITY,
	city VARCHAR(255),
	name varchar(255) UNIQUE,
	category varchar(255),
	adress varchar(255),
	PRIMARY KEY(id)
);

CREATE TABLE Specialist(
	id INT GENERATED ALWAYS AS IDENTITY,
	company_id INT,
	user_id INT,
	name varchar(255) UNIQUE,
	phone varchar(255) UNIQUE,
	PRIMARY KEY(id),
	CONSTRAINT fk_company
		FOREIGN KEY(company_id)
			REFERENCES Company(id),
	CONSTRAINT fk_user
		FOREIGN KEY(user_id)
			REFERENCES Users(id)
);

CREATE TABLE Service(
	id INT GENERATED ALWAYS AS IDENTITY,
	company_id INT,
	service_name varchar(255),
	PRIMARY KEY(id),
	CONSTRAINT fk_company
		FOREIGN KEY(company_id)
			REFERENCES Company(id)
);


CREATE TABLE TimeTable(
	id INT GENERATED ALWAYS AS IDENTITY,
	specialist_id INT,
	day DATE,				--kinda pointless
	start_time DATE,
	end_time DATE,	
	PRIMARY KEY(id)
);

CREATE TABLE Availability(
	id INT GENERATED ALWAYS AS IDENTITY,
	specialist_id INT,
	start_time DATE,
	end_time DATE,
	PRIMARY KEY(id),
	CONSTRAINT fk_specialist
		FOREIGN KEY(specialist_id)
			REFERENCES Specialist(id)
);

CREATE TABLE SpecialistService(
	id INT GENERATED ALWAYS AS IDENTITY,
	specialist_id INT,
	service_id INT,
	duration real , 
	PRIMARY KEY(id),
	CONSTRAINT fk_specialist
		FOREIGN KEY(specialist_id)
			REFERENCES Specialist(id),
	CONSTRAINT fk_service
		FOREIGN KEY(service_id)
			REFERENCES Service(id)
);

CREATE TABLE Schedule(
	id INT GENERATED ALWAYS AS IDENTITY,
	user_id INT,
	specialist_id INT,
	service_id INT,
	star_date DATE,
	end_date DATE,
	PRIMARY KEY(id),
	CONSTRAINT fk_user
		FOREIGN KEY(user_id)
			REFERENCES Users(id),
	CONSTRAINT fk_specialist
		FOREIGN KEY(specialist_id)
			REFERENCES Specialist(id),
	CONSTRAINT fk_service
		FOREIGN KEY(service_id)
			REFERENCES Service(id)
);
